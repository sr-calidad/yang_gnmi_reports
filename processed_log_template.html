<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="https://fonts.cdnfonts.com/css/times-new-roman" rel="stylesheet">
    <title>Testcase Reportsss - {{model_info_raw}}</title>
    
      
   
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>
  

  <style>
    /* ---------------------------- */
    /* General Page & Layout Styles */
    /* ---------------------------- */
    html,
    body {
      /*height: 100%; /* Full viewport height */
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #b7afaf;
      /* background: linear-gradient(
      135deg
,     rgb(145 145 145) 0%, rgb(144 122 122) 100%);
      overflow: hidden; */
    }
    
    /* header {
    position: fixed;
    top: 0;
    left: 0;
    width: 110%;
    background: linear-gradient(135deg, rgb(209 209 209) 0%, rgb(144 122 122) 100%); /* Same as consolidated report */
    /* z-index: 1000;
    text-align: center;
    padding: 15px 0;
    color: white;
    font-family: "Times New Roman", serif;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
} */ 

    header {
        position: absolute; /* Instead of fixed or sticky */
        top: -5px;
        left: 0;
        width: 100%;
        padding: 0px;
        background: linear-gradient(135deg, rgb(209 209 209) 0%, rgb(144 122 122) 100%);
        color: white;
        text-align: center;
        font-size: 10px;
        font-family: "Times New Roman", serif;
        z-index: 1000;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
    }
    

    /* header h1 {
        font-family: "Times New Roman", serif !important;
        margin: 0;
        font-size: 1.5rem;
        border-bottom: #211d1d;
        } */

    /* .title {
        font-family: "Times New Roman", serif !important;
        font-size: 24px; /* Adjust size as needed */
        /* font-weight: bold; */
        /* text-align: center; */
        /* color: black; Change color if needed */
      /* } */ 



  

  /* Ensure content isn't hidden under the fixed header */
  body {
      padding-top: 60px; /* Adjust as needed */
  }

    /* header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      /* background: inherit; */
      /* z-index: 1000;
      text-align: center;
      padding: 6px 0;
    } */ */
    /* header h1 {
      margin: 0;
      font-size: 1.5rem;
      border-bottom: #211d1d;
    } */

    summary.collapsible-summary {
      color: #292e2f;
      background-color: #e8edee; /* Background color for summary */
      padding: 8px 12px;
      cursor: pointer;
      font-weight: bold;
      display: inline-block;
      max-width: 300px;
    }
    summary {
      display: list-item;
      cursor: pointer;
    }

    /* Main container placed below header */
    #container {
      position: absolute;
      top: 8px; /* Offset for fixed header */
      bottom: 0;
      width: 100%;
      display: flex;
      gap: 20px;
      overflow: auto;
      padding: 10px;
      max-height: 1200px;
    }

          /* Ensure links and visited links do not turn blue or purple */
    a, a:visited, a:focus, a:active {
      color: inherit !important; /* Inherit the default text color */
      text-decoration: none !important; /* Remove underline */
    }

    /* Keep the tab color grey when clicked or focused */
    #testcase-list li:focus,
    #testcase-list li:active {
      background-color: #c8ccd5 !important;
      color: #333 !important;
      outline: none; /* Remove focus outline */
    }

    /* Left & Right Panels take full height */
    #left-panel,
    #right-panel {
      height: 100%;
      display: flex;
      flex-direction: column;
      margin-top: 35px;
    }
    #left-panel {
      /*width: 22%; */
      min-width: 200px;
    }
    #right-panel {
      flex: 1;
    }

    /* Card common styling */
    .card {
      display: flex;
      flex-direction: column;
      height: 100%;
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      background: #fff;
    }
    .small-testcase-box {
      font-size: 1.1rem;
      border-collapse: collapse;
      margin: 10px auto; /* Center */
      box-shadow: 0 2px 8px #333;
      width: 50%;
      max-width: 200px; /* Increased to make it more visible */
      padding: 8px;
      border: 1px solid #943c3c;
      background-color: white;
      display: inline-block; /* Prevents full-width expansion */
  }

  .small-testcase-box h5 {
      text-align: center;
      font-size: 1rem;
      margin-bottom: 10px; /* Reduced margin */
  }

    .small-testcase-title {
    color: red;
    font-size: 1.1rem;
    text-align: center;
    font-weight: bold;
}


    .card-header {
      padding: 10px 15px;
      font-weight: bold;
    }
    #left-panel .card-header,
    #right-panel .card-header {
      background-color: #ddd;
      color: #211d1d;
    }
    .card-body {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
    }

    /* Testcase List styling */
    #testcase-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }
    #testcase-list li {
      margin: 8px 0;
      padding: 8px 12px;
      border-radius: 6px;
      transition: none;
      color: #333;
      font-weight: 500;
      cursor: pointer;
    }
    #testcase-list li:hover {
      background-color: #c8ccd5;
    }

    #testcase-list li:not(.active) {
      background-color: transparent !important;
      color: #333 !important;
      transition: none !important;
}
    #testcase-list li.active {
        background-color: #c8ccd5 !important;
        color: #111 !important;
        transition: none !important;
}

  /* Combine hover and open states for details */
details:hover,
details[open] {
  background-color: #c8ccd5 !important; /* Match testcase list hover color */
  box-shadow: 0 2px 4px rgba(200, 204, 213, 0.5);
}
    /* ------------------------------------------------------ */
    /* Additional CSS for Python-generated Log (Testcase Data) */
    /* ------------------------------------------------------ */
    #logContent .testcase-section {
      margin: 24px;
      padding: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #fafafa;
    }

    /* ASCII table styling */
    #logContent .testcase-section .ascii-table {
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      width : auto;
      margin-left: 10px;
    }
    #logContent .testcase-section .ascii-table thead {
      background-color: #f5f5f5;
      color: black;
    }
    #logContent .testcase-section .ascii-table th,
    #logContent .testcase-section .ascii-table td {
      border: 1px solid #ddd;
      padding: 8px 12px;
      text-align: left;
      vertical-align: top;
      width: auto;
    }
    #logContent .testcase-section .ascii-table tbody tr:nth-child(odd) {
      background: linear-gradient(to right, #e8edee, #e8edee);
      width: auto;
    }
    #logContent .testcase-section .ascii-table tbody tr:hover {
      background-color: #f1f1f1;
      width: auto;
    }
    #logContent .testcase-section .ascii-table th {
      font-weight: bold;
      width: auto;
    }

    /* Collapsible section styling */
    #logContent .testcase-section .collapsible-section {
      margin: 0;
      width: auto;
    }
    #logContent .testcase-section .collapsible-section:not([open]) {
      display: inline-block;
      background-color: transparent;
      padding: 0;
      width: auto;
    }
    #logContent .testcase-section .collapsible-section[open] {
      display: block;
      width: auto;
    }

    /* Collapsible summary styling */
    #logContent .testcase-section .collapsible-summary {
      background-color: #e8edee;
      padding: 8px 12px;
      cursor: pointer;
      font-weight: bold;
      display: inline-block;
      max-width: 600px;
      width: auto;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    #logContent .testcase-section .collapsible-summary::before {
      content: "\25B6"; /* Unicode for right-pointing arrow */
      display: inline-block;
      margin-right: 8px;
      font-size: 0.8em;
      transition: transform 0.3s ease;
      width: auto;
    }
    #logContent
      .testcase-section
      .collapsible-section[open]
      .collapsible-summary::before {
      transform: rotate(90deg);
      width: auto;
    }

    /* Collapsible box styling */
    #logContent .testcase-section .collapsible-box {
      /*padding: 10px; */
      background-color: #f8f9fa;
      width: 100%;
      max-height: 400px;
      overflow-y: scroll;
      width: auto;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      
/*       
      padding: 10px;
      border: 1px solid #ccc;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 0.9rem;
      max-width: 100%; */
    }


    /* Log display for preformatted text */
    pre {
      background: #f8f9fa;
      /*padding: 10px; */
      border: 1px solid #ccc;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      /*margin: 0px 0; */
      border-radius: 4px;
      font-size: 0.9rem;
      max-width: 100%;
    }

    /* For vertically stacked collapsible sections */
    #logContent
      .testcase-section
      .collapsible-section
      + .collapsible-section {
      margin-top: 5px;
    }

    .testcase-box.pass h5 {
      color: green;
    }
    .testcase-box.fail h5 {
      color: red;
    }
    .testcase-box.promoted_pass h5{
      color: orange;
    }

    .testcase-box.anomaly_pass h5{
      color: #1e79ff;
    }

    .status-icon.pass {
      color: green;
    }
    .status-icon.fail {
      color: red;
    }



  </style>
  </head>
  <body>
    <!-- Fixed Header at the top (currently commented out) -->
    <header>
      <!-- <h1 style="font-family: 'Times New Roman', serif !important;">Testcase Logs <span class="small-arrow">&#9654;</span> Model : {{model_info_raw}}</h1> -->

      <h1 style="font-family: 'Times New Roman', serif !important;">
        Testcase Logs{{model_heading}}
      </h1>
      
  
  </header>

    <!-- Main Container Below Header -->
    <div id="container">
      <!-- Left Panel: Displays the Testcase List -->
      <div id="left-panel">
        <div class="card">
          <div class="card-header">
            <i class="bi bi-list-check"></i> Testcase List
          </div>
          <div class="card-body p-0">
            <ul id="testcase-list"></ul>
          </div>
        </div>
      </div>

      <!-- Right Panel: Displays the Detailed Testcase Information -->
      <div id="right-panel">
        <div class="card">
          <div class="card-header">
            <i class="bi bi-layout-sidebar-inset"></i> Testcase Details
          </div>
          <div class="card-body" id="rightPanelBody">
            <div id="logContent"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript Section -->
    <script>

      

      function removePatternBeforeAsciiTable(html) {
        return html.replace(/\+[-]+\+(?=\s*<table class="ascii-table">)/g, '');
      }
      function removeExtraWhitespace(html) {
        // Remove extra whitespace between HTML tags without adding an extra space.
         return html.replace(/>\s{2,}</g, '>\n<');
      }
      function cleanTestcaseData(data) {
        // Remove other ASCII borders if needed:
        data = data
          .split('\n')
          .filter(line => !/^\s*\+[-]+\+\s*$/.test(line))
          .join('\n');
        // Remove our specific pattern before the ascii table.
        data = removePatternBeforeAsciiTable(data);
        data = removeExtraWhitespace(data);
        // ✅ Remove unnecessary <br> tags and merge into one line
        data = data.replace(/<br>/g, ' ');
        data = data.replace(/<br>/g, ' '); // Converts <br> into a space
        return data;
      }
        // Retrieve the testcase data provided by the templating system.
        // The placeholder {{testcase_data}} should be replaced by actual JSON data.

        const testcaseData = {{testcase_data}};
        const model_info = {{model_info}};
        console.log(testcaseData);
        console.log(model_info);

        // Variable to build the HTML for testcase details in the right panel.
        let detailsHTML = '';

        // Sort the testcase keys in natural (numeric) order for consistent display.
        const sortedTestcases = Object.keys(testcaseData).sort((a, b) =>
          a.localeCompare(b, undefined, { numeric: true })
        );

        sortedTestcases.forEach(tc => {
          const rawHTML = testcaseData[tc];

          const parser = new DOMParser();
          const doc = parser.parseFromString(rawHTML, 'text/html');
          // const status = doc.querySelector('.testcase-section')?.getAttribute('data-status') || 'pass';

          // const parser = new DOMParser();
          // const doc = parser.parseFromString(rawHTML, 'text/html');
          const section = doc.querySelector('.testcase-section');
          const status = section?.getAttribute('data-status') || 'pass';
          const color = section?.getAttribute('data-color') || 'green';

    
          const iconColor = status === 'anomaly_pass' ? '#1e79ff' :
                  status === 'promoted_pass' ? 'orange' : color;
          const icon = status === 'fail'
            ? '<span style="color: red;">X</span>'
            : `<span style="color: ${iconColor}; font-size: 15px;">&#10003;</span>`;

          ;

          const li = document.createElement("li");
          li.innerHTML = `${tc}<span style="float: right;">${icon}</span>`;
          li.setAttribute("data-tc", tc);

          li.addEventListener('click', (e) => {
            e.preventDefault();
            document.querySelectorAll('#testcase-list li.active').forEach(item => {
              item.classList.remove('active');
            });
            li.classList.add('active');

            const target = document.getElementById('testcase-' + tc);
            if (target) {
              const container = document.getElementById("rightPanelBody");
              const containerRect = container.getBoundingClientRect();
              const targetRect = target.getBoundingClientRect();
              const offset = targetRect.top - containerRect.top;

              requestAnimationFrame(() => {
                target.scrollIntoView({ block: "start", behavior: "smooth" });
                container.scrollTop = target.offsetTop - 60;
              });
            }
          });

          document.getElementById("testcase-list").appendChild(li);

          // ✅ MOVE THIS INTO LOOP!
          const cleanData = cleanTestcaseData(rawHTML);
          const isSmallTestcase = cleanData.length < 200 || cleanData.split("\n").length < 10;

          detailsHTML += `<div id="testcase-${tc}" class="testcase-box ${status} ${isSmallTestcase ? 'small-testcase-box' : ''}" style="margin-top: 15px;">`;

          detailsHTML += `<h5 style="
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
            border-collapse: collapse;
            box-shadow: 0 2px 8px #adb5bd;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: white;
            display: inline-block;">
            ${tc}
          </h5>`;

          detailsHTML += `<pre>${cleanData}</pre>`;
          detailsHTML += `</div>`;
        });


        // Insert the built testcase details into the logContent container.
        document.getElementById("logContent").innerHTML = detailsHTML;

        // Add a slight delay to ensure elements are loaded before applying scroll sync
        setTimeout(() => {
            // Only highlight first item if no test_id exists
            let urlParams;
            try {
              urlParams = new URLSearchParams(window.parent.location.search);
            } catch {
              urlParams = new URLSearchParams(window.location.search);
            }
            if (!urlParams.has('test_id')) {
                    const firstItem = document.querySelector("#testcase-list li");
                    if (firstItem) {
                        firstItem.classList.add("active");
                        firstItem.scrollIntoView({ block: "nearest", behavior: "smooth" });
                    }
                }
            document.getElementById("rightPanelBody").addEventListener("scroll", () => {
                let currentTestcase = null;
                let minDifference = Number.POSITIVE_INFINITY;
                document.querySelectorAll("#logContent > div").forEach(testcase => {
                    const rect = testcase.getBoundingClientRect();
                    if (rect.top >= 0 && rect.top <= 200) {
                        currentTestcase = testcase.id.replace("testcase-", "");
                    }
                });

                if (currentTestcase) {
                    document.querySelectorAll("#testcase-list li").forEach(item => item.classList.remove("active"));
                    const activeItem = document.querySelector(`[data-tc="${currentTestcase}"]`);
                    if (activeItem) {
                      activeItem.classList.add("active");
                      activeItem.scrollIntoView({ block: "nearest", behavior: "smooth" });
                    }

                }
            });
        }, 200);

       
 function openGNMIResponseInNewTab(elementId) {
  var responseContent = document.getElementById(elementId).innerText;
  var newTab = window.open("", "_blank");
  newTab.moveTo(0, 0);
  newTab.resizeTo(screen.width, screen.height);
  
  if (newTab) {
      newTab.document.write("<!DOCTYPE html><html lang='en'><head><title>GNMI Response</title>");
      newTab.document.write("<style>");
      newTab.document.write('<style>body { font-family: "Times New Roman", serif; margin: 0; padding: 10px; }</style>');
  // Removed default margin, added slight padding
      newTab.document.write("h2 { margin: 0; padding: 10px; background-color: #f8f9fa; border-bottom: 1px solid #ccc; text-align: center; }"); // Well-aligned title
      newTab.document.write("pre { white-space: pre-wrap; word-wrap: break-word; margin: 0; padding: 10px; }");
      newTab.document.write("</style></head>");
      newTab.document.write("<body>");
      newTab.document.write("<h2>GNMI Response</h2>");
      newTab.document.write("<pre>" + responseContent + "</pre>");
      newTab.document.write("</body></html>");
      newTab.document.close();
  } else {
      alert("Unable to open new window. Please allow pop-ups for this site.");
  }
} 
    </script>
    
 <script>
  // multiple result//
  
    document.addEventListener('DOMContentLoaded', () => {
        // Get test_id from URL
        const params = new URLSearchParams(window.location.search);
        const testId = params.get('test_id');

        if (testId) {
            // Find target elements
            const target = document.getElementById("testcase-" + testId);
            const testcaseListContainer = document.querySelector("#left-panel .card-body");
            const selectedTestcase = document.querySelector(`[data-tc="${testId}"]`);

            if (target && selectedTestcase) {
                // Clear existing highlights - CORRECTED SELECTORS
                document.querySelectorAll('#left-panel li.active, #logContent > div.active').forEach(el => {
                    el.classList.remove('active');
                });

                // Apply new highlights
                selectedTestcase.classList.add('active');
                target.classList.add('active');

                // Scroll to positions
                testcaseListContainer.scrollTop = selectedTestcase.offsetTop - 100;
                document.getElementById("rightPanelBody").scrollTop = target.offsetTop - 60;
            }
        }
    });

    // OR for single entry of result
//     document.addEventListener('DOMContentLoaded', () => {
//   // Get test_id from URL
//   const params = new URLSearchParams(window.location.search);
//   const testId = params.get('test_id');

//   if (testId) {
//     // Find the target elements for the selected testcase
//     const target = document.getElementById("testcase-" + testId);
//     const selectedTestcase = document.querySelector(`[data-tc="${testId}"]`);

//     if (target && selectedTestcase) {
//       // Clear and update the left panel:
//       // Remove all list items from the testcase list except the one with the matching testId.
//       const testcaseList = document.getElementById("testcase-list");
//       Array.from(testcaseList.children).forEach(child => {
//         if (child.getAttribute("data-tc") !== testId) {
//           child.remove();
//         } else {
//           // Ensure the selected list item has the "active" class
//           child.classList.add("active");
//         }
//       });

//       // Clear and update the right panel:
//       // Remove all testcase details except the one matching the testId.
//       const logContent = document.getElementById("logContent");
//       Array.from(logContent.children).forEach(child => {
//         if (child.id !== "testcase-" + testId) {
//           child.remove();
//         }
//       });

//       // Optionally, scroll the panels to show the selected testcase
//       const testcaseListContainer = document.querySelector("#left-panel .card-body");
//       testcaseListContainer.scrollTop = selectedTestcase.offsetTop - 100;
//       document.getElementById("rightPanelBody").scrollTop = target.offsetTop - 60;
//     }
//   }
// });

</script>
  </body>
</html>
