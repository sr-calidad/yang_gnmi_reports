<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title >Xpath Test Results</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="/css/result-light.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
  <script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <!-- Fixed Header CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.2.2/css/fixedHeader.bootstrap4.min.css">

<!-- Fixed Header JS -->
<script type="text/javascript" src="https://cdn.datatables.net/fixedheader/3.2.2/js/dataTables.fixedHeader.min.js"></script>

  <style type="text/css">
    body {
      min-height: 100vh;
      background-color: #b7afaf;
      background-image: #b7afaf;
      /* white-space: nowrap !important;  /* Prevent wrapping */
      /* background-image: linear-gradient(147deg, #FFE53B 0%, #FF2525 100%); */
      padding-top: 60px;
      overflow-x: hidden;
    }
    .header-container {
      width: 100%;
      position: fixed; /* Keeps the title fixed at the top */
      top: 0;
      left: 0;
      background:linear-gradient(135deg, rgb(209 209 209) 0%, rgb(144 122 122) 100%); /* Dark background for contrast */
      color: white;
      padding: 8px 0;
      text-align: center;
      z-index: 1000; /* Ensures it stays on top */
      font-family: "Times New Roman", serif;
      
      
    }

    .pt-5, .py-5 {
    padding-top: 0rem !important;
    }

    .title {
      font-size: 25px;
      margin: 0;
    }
    .content {
      margin-top: 60px; /* Space for content below the header */
      padding: 20px;
    }


    /* Adjust the TestCase column width */
    th:nth-child(3), td:nth-child(3) { 
        max-width: 3000px; /* Adjust width as needed */
        white-space: normal;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    h1 {
      font-size: 22px !important; 
      color: rgb(255, 255, 255); /* White text */
      text-align: center;
    }

    


    /* Reduce the Log column width */
    th:nth-child(9), td:nth-child(9) { 
        max-width: 200px; /* Adjust width as needed */
        white-space: nowrap;   /* Prevent text from wrapping */
        overflow: hidden;
        text-overflow: ellipsis; /* Show '...' for long text */
        cursor: pointer; /* Indicate interactivity */
        
    }

    .top-container,
    .bottom-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
    }

    .dataTables_length {
    display: flex;
    align-items: center;
    margin-right: 20px; /* Add spacing */
    margin-top: 10px;
}

.dataTables_info {
    display: flex;
    align-items: center;
    white-space: nowrap;
    margin-left: 15px; /* Add spacing */
}

.dataTables_paginate {
    margin-left: auto; /* Push pagination to the right */
}

div.dataTables_wrapper div.dataTables_info {
    padding-top: 0.0em;
    white-space: nowrap;
}

  </style>
</head>
<body>
  <div width="100%">

    <!-- <header class="text-center text-white">
      <br>
      <h1 class="display-4">Xpath Test Results</h1>
    </header> -->

    <div class="header-container">
      <h1 class="title">Xpath Test Results</h1>
    </div>

    <!-- Summary Table -->
    <div class="row py-5">
      <div class="col-lg-10 mx-auto">

        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; margin-top: 15px; margin-bottom: 10px;">
  
          <div style="display: flex; align-items: center; gap: 10px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                  <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>
              </svg>
        
              <p class="lead mb-1 rounded text-black" 
                style="box-shadow: 0px 8px 8px -6px rgba(0,0,0,.5); background-color:#d0d8e1; margin: 0;">
                <!-- padding: 5px 10px; -->
                  Test Result Summary
              </p>
          </div>
        
          <!-- Download Button with the same size as Test Summary -->
          <button id="downloadExcel" class="btn btn-success"
                  style="padding: 5px 6px; font-size: 16px; font-weight: bold; height: auto;">
              <i class="fa fa-download"></i> Download Excel
          </button>
        
        </div>
        
      
      
      
        <div class="card rounded shadow border-0">
          <div class="card-body p-3 bg-white rounded">
            <div class="table-responsive">
              <table class="table table-striped table-bordered">
                <tr>
                  <td>Model Info.: <strong>xpath_model_info</strong></td>
                  <td>Total Paths - <strong>xpath_total_paths</strong></td>
                  <td>Config Paths - <strong>xpath_config_paths</strong></td>
                  <td>Set/Get/Sub Paths-<strong>xpath_set_get_sub</strong></td>
                  <td>State Only Paths - <strong>xpath_state_only</strong></td>
                  <td>Deviations - <strong>xpath_deviations</strong></td>
                  <td>Test Release Version - <strong>xpath_test_release</strong></td>
                  <td>Platform Support - (<strong>xpath_platform</strong>)</td>
                </tr>
                <tr>
                  <td colspan="2">Test Summary</td>
                  <td>Total Tested Paths - <strong>xpath_tested_paths</strong></td>
                  <td>Input Config Paths - <strong>xpath_input_config</strong></td>
                  <td>Tested Set/Get/Sub Paths - <strong>xpath_tested_set_get_sub</strong></td>
                  <td>Tested State-Only Paths - <strong>xpath_tested_state_only</strong></td>
                  <td colspan="2">Test Coverage - <strong>xpath_test_coverage</strong></td>
                </tr>
                <tr>
                  <td colspan="2">Test Result</td>
                  <td>Total Testcases - <strong>xpath_total_testcases</strong></td>
                  <td>Passed - <strong>xpath_passed</strong></td>
                  <td>Failed - <strong>xpath_failed</strong></td>
                  
                  <td id="resultText" colspan="1"><strong>xpath_overall_result</strong></td>
                  <td style="color:orange; width: 300px; height: 50px; overflow: auto; border: 1px solid #ccc; padding: 5px;">
                      <strong>
                        D -> Deviation, S -> Sub-Xpaths, P -> Platform,<br>
                        P-NA -> Not supported in any platform,<br>
                        P-NS -> Not supported in this platform
                    </strong>
                </td>
                
                  
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Results Table -->
    <div class="row py-5">
      <div class="col-lg-10 mx-auto">
        <div class="card rounded shadow border-0">
          <div class="card-body p-5 bg-white rounded">
            <div class="table-responsive">
              <table id="example" style="width:100%" class="table table-striped table-bordered">
                <thead>
                  <tr>
                    <th style="text-align: right;">S.No</th>
                    <th>TC_ID</th>
                    <th>TestCase</th>
                    <th>GNMI Operation</th>
                    <th>Status</th>
                    <th>Deviation</th>
                    <th>Platform (<strong>xpath_p_result </strong>)</th>
                    <th>Result</th>
                    <th>Log</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- xpath_detail_rows -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
  <script>
  
    // Set the color based on the value of xpath_overall_result
    document.getElementById("resultText").style.color = (xpath_overall_result == "PASS") ? "green" : "red";
  </script>
  <script>
    $(document).ready(function() {
    var table = $('#example').DataTable({
      "order": [[ 1, "asc" ]], // Orders by the second column (TC_ID) in ascending order
        "pageLength": 10,  // Default to show all entries
        "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]], // Added "All" option
        "scrollX": false,  // Enable horizontal scrolling
        "fixedHeader": {
            header: true,  // Keeps the header fixed
            footer: false  // Footer remains scrollable
        },
        "columnDefs": [
          { targets: [3,4,5], width: "auto" }  // Compact columns
        ],
        
        "dom": '<"top-container d-flex justify-content-between align-items-center"<"d-flex align-items-center"l i>p>rt<"bottom-container d-flex justify-content-between align-items-center"<"d-flex align-items-center"l i>p>',
        "createdRow": function(row, data, dataIndex) {
            $(row).find("td:eq(7), td:eq(4)").each(function() {
                var cellText = $(this).text().trim();
                if (cellText.startsWith("PASS")) {
                    if (cellText.includes("(P-NS)")) {
                        $(this).css({"color": "orange", "font-weight": "bold"});  // PASS with (P-NS) → ORANGE
                    } else {
                        $(this).css({"color": "green", "font-weight": "bold"});  // Any other PASS → GREEN
                    }
                } else if (cellText === "FAIL") {
                    $(this).css({"color": "red", "font-weight": "bold"});  // FAIL → RED
                }
            });
        },
        "drawCallback": function(settings) {
          // Update the S.No column to reflect the current order/page
          var api = this.api();
            api.column(0, { page: 'current' }).nodes().each(function(cell, i) {
                cell.innerHTML = i + 1;
            });
            
            $('#example tbody tr').each(function() {
                $(this).find("td:eq(4), td:eq(7)").each(function() {
                    var cellText = $(this).text().trim();
                    if (cellText.startsWith("PASS")) {
                        if (cellText.includes("(P-NS)")) {
                            $(this).css({"color": "orange", "font-weight": "bold"});
                        } else {
                            $(this).css({"color": "green", "font-weight": "bold"});
                        }
                    } else if (cellText === "FAIL") {
                        $(this).css({"color": "red", "font-weight": "bold"});
                    }
                });
            });
        }
    });

    // Ensure header remains fixed on horizontal scroll
    $('.dataTables_scrollBody').on('scroll', function() {
        $('.dataTables_scrollHead').scrollLeft($(this).scrollLeft());
    });
});

    $("#downloadExcel").click(function() {
        var wb = XLSX.utils.book_new();
        var allData = [];

        // ✅ Capture all tables (Summary + Detailed Results)
        document.querySelectorAll("table").forEach((table, index) => {
            var tableData = [];

            // Extract headers
            var headers = [];
            table.querySelectorAll("thead th").forEach(th => {
                headers.push(th.innerText.trim());
            });
            if (headers.length > 0) {
                allData.push(headers); // Add headers only if found
            }

            // Extract table rows
            table.querySelectorAll("tbody tr").forEach(row => {
                var rowData = [];
                row.querySelectorAll("td").forEach(td => {
                    rowData.push(td.innerText.trim());
                });
                allData.push(rowData);
            });

            // Add empty row for separation between tables
            allData.push([]);
        });

        // ✅ Create Excel Sheet with Combined Data
        var ws = XLSX.utils.aoa_to_sheet(allData);

        // ✅ Auto-adjust column width
        const columnWidths = allData[0].map((_, colIndex) => ({
            wch: Math.max(...allData.map(row => (row[colIndex] ? row[colIndex].toString().length : 0))) + 2
        }));

        ws['!cols'] = columnWidths; // Apply auto-width settings

        XLSX.utils.book_append_sheet(wb, ws, "Test Results");

        // ✅ Save the Excel file
        XLSX.writeFile(wb, "Xpath_Test_Results.xlsx");
    });

    $(document).ready(function () {
    // Create tooltip div (hidden by default)
    $('body').append('<div id="logTooltip" style="position: absolute; pointer-events: none; display: none; background: rgba(0, 0, 0, 0.95); color: white; padding: 8px 12px; border-radius: 5px; max-width: 400px; white-space: normal; word-wrap: break-word; z-index: 1000; box-shadow: 2px 2px 10px rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.1s ease-in-out;"></div>');

    let activeCell = null;
    let tooltipVisible = false;
    let hideTooltipTimeout;

    // Show tooltip on hover & adjust position dynamically
    $('#example tbody').on('mouseenter', 'td:nth-child(9)', function () {
        clearTimeout(hideTooltipTimeout); // Prevent immediate hiding

        const logText = $(this).text().trim();
        if (logText.length > 0) {
            activeCell = $(this);

            $('#logTooltip').text(logText).css({
                maxWidth: '400px',
                whiteSpace: 'normal',
                display: 'block',
                opacity: 1
            });

            const cellOffset = activeCell.offset();
            const cellWidth = activeCell.outerWidth();
            const cellHeight = activeCell.outerHeight();
            const tooltipWidth = $('#logTooltip').outerWidth();
            const windowWidth = $(window).width();

            let tooltipLeft = cellOffset.left + cellWidth + 10;
            if (tooltipLeft + tooltipWidth > windowWidth) {
                tooltipLeft = windowWidth - tooltipWidth - 10;
            }

            $('#logTooltip').css({
                top: cellOffset.top + (cellHeight / 2) - 10 + 'px',
                left: tooltipLeft + 'px'
            }).stop(true, true).fadeIn(100);

            tooltipVisible = false;
        }
    });

    // Hide tooltip when leaving the "Log" column or tooltip
    $('#example tbody').on('mouseleave', 'td:nth-child(9)', function () {
    hideTooltipTimeout = setTimeout(() => {
        $('#logTooltip').stop(true, true).fadeOut(100, function () {
            $(this).css({ display: 'none' });
        });
        activeCell = null;
        tooltipVisible = false;
    }, 100);
});


    $('#logTooltip').on('mouseleave', function () {
        hideTooltipTimeout = setTimeout(() => {
            $(this).stop(true, true).fadeOut(100, function () {
                $(this).css({ display: 'none' });
            });
            activeCell = null;
            tooltipVisible = false;
        }, 100);
    });

    // Hide tooltip when clicking anywhere outside
    $(document).on('click', function (event) {
        if (!$(event.target).closest('td:nth-child(9), #logTooltip').length) {
            $('#logTooltip').stop(true, true).fadeOut(100, function () {
                $(this).css({ display: 'none' });
            });
            activeCell = null;
            tooltipVisible = false;
        }
    });

    // Hide tooltip when scrolling
    $(window).on('scroll', function () {
        $('#logTooltip').stop(true, true).fadeOut(100, function () {
            $(this).css({ display: 'none' });
        });
        activeCell = null;
        tooltipVisible = false;
    });
});

function openLogInNewTab(event, testId, linkElement) {
    // Prevent the default link behavior (which is navigating to the link)
    event.preventDefault();

    // Extract the href from the clicked link element
    var logDetailsUrl = linkElement.getAttribute('href');

    // Make sure the URL contains the test_id
    if (logDetailsUrl.includes("?test_id=")) {
        // Open the log details page in a new window or tab
        var newWindow = window.open(logDetailsUrl, '_blank');
        if (newWindow) {
            newWindow.focus();
        } else {
            alert("Unable to open new window. Please allow pop-ups for this site.");
        }
    } else {
        alert('Invalid URL format. Please check the link.');
    }
}

document.addEventListener("DOMContentLoaded", function() {
    var resultCell = document.getElementById("resultText");

    if (resultCell) {
        var resultText = resultCell.innerText.trim(); // Get actual text from the cell

        // Ensure proper comparison by converting to uppercase
        if (resultText.toUpperCase() === "PASS") {
            resultCell.style.color = "green";  // Set color for PASS
            resultCell.style.fontWeight = "bold";
        } else if (resultText.toUpperCase() === "FAIL") {
            resultCell.style.color = "red";  // Set color for FAIL
            resultCell.style.fontWeight = "bold";
        } else {
            resultCell.style.color = "black"; // Default color
        }
    }
});
  </script>
</body>
</html>